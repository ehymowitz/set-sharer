{"ast":null,"code":"import bcrypt from 'bcrypt';\nimport jwt from 'jsonwebtoken';\nimport cookie from 'cookie';\nimport { PrismaClient } from '@prisma/client';\nconst prisma = new PrismaClient();\nexport default (async (req, res) => {\n  const salt = bcrypt.genSaltSync();\n  const {\n    setName,\n    password\n  } = req.body;\n  let set;\n\n  try {\n    set = await prisma.set.create({\n      data: {\n        setName,\n        password: bcrypt.hashSync(password, salt)\n      }\n    });\n  } catch (error) {\n    console.log(error);\n    res.json({\n      error: error\n    });\n    return;\n  }\n\n  const token = jwt.sign({\n    setName: set.setName,\n    id: set.id,\n    time: new Date()\n  }, process.env.JWT_SECRET, {\n    expiresIn: \"6h\"\n  });\n  res.setHeader(\"Set-Cookie\", cookie.serialize(\"token, token\", {\n    httpOnly: true,\n    maxAge: 6 * 60 * 60,\n    path: \"/\",\n    sameSite: \"lax\",\n    secure: false\n  }));\n  res.json(set);\n  return;\n});","map":{"version":3,"sources":["/Users/elie/code/ehymowitz/set-sharer/pages/api/create.ts"],"names":["bcrypt","jwt","cookie","PrismaClient","prisma","req","res","salt","genSaltSync","setName","password","body","set","create","data","hashSync","error","console","log","json","token","sign","id","time","Date","process","env","JWT_SECRET","expiresIn","setHeader","serialize","httpOnly","maxAge","path","sameSite","secure"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,GAAP,MAAgB,cAAhB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,YAAT,QAA6B,gBAA7B;AACA,MAAMC,MAAM,GAAG,IAAID,YAAJ,EAAf;AAEA,gBAAe,OAAOE,GAAP,EAAYC,GAAZ,KAAoB;AACjC,QAAMC,IAAI,GAAGP,MAAM,CAACQ,WAAP,EAAb;AACA,QAAM;AAAEC,IAAAA,OAAF;AAAWC,IAAAA;AAAX,MAAwBL,GAAG,CAACM,IAAlC;AACA,MAAIC,GAAJ;;AACA,MAAI;AACFA,IAAAA,GAAG,GAAG,MAAMR,MAAM,CAACQ,GAAP,CAAWC,MAAX,CAAkB;AAC5BC,MAAAA,IAAI,EAAE;AACJL,QAAAA,OADI;AAEJC,QAAAA,QAAQ,EAAEV,MAAM,CAACe,QAAP,CAAgBL,QAAhB,EAA0BH,IAA1B;AAFN;AADsB,KAAlB,CAAZ;AAMD,GAPD,CAOE,OAAOS,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACAV,IAAAA,GAAG,CAACa,IAAJ,CAAS;AAAEH,MAAAA,KAAK,EAAEA;AAAT,KAAT;AACA;AACD;;AACD,QAAMI,KAAK,GAAGnB,GAAG,CAACoB,IAAJ,CACZ;AAAEZ,IAAAA,OAAO,EAAEG,GAAG,CAACH,OAAf;AAAwBa,IAAAA,EAAE,EAAEV,GAAG,CAACU,EAAhC;AAAoCC,IAAAA,IAAI,EAAE,IAAIC,IAAJ;AAA1C,GADY,EAEZC,OAAO,CAACC,GAAR,CAAYC,UAFA,EAGZ;AACEC,IAAAA,SAAS,EAAE;AADb,GAHY,CAAd;AAQAtB,EAAAA,GAAG,CAACuB,SAAJ,CACE,YADF,EAEE3B,MAAM,CAAC4B,SAAP,CAAiB,cAAjB,EAAiC;AAC/BC,IAAAA,QAAQ,EAAE,IADqB;AAE/BC,IAAAA,MAAM,EAAE,IAAI,EAAJ,GAAS,EAFc;AAG/BC,IAAAA,IAAI,EAAE,GAHyB;AAI/BC,IAAAA,QAAQ,EAAE,KAJqB;AAK/BC,IAAAA,MAAM;AALyB,GAAjC,CAFF;AAUA7B,EAAAA,GAAG,CAACa,IAAJ,CAASP,GAAT;AACA;AACD,CApCD","sourcesContent":["import bcrypt from 'bcrypt'\nimport jwt from 'jsonwebtoken'\nimport cookie from 'cookie'\nimport { PrismaClient } from '@prisma/client'\nconst prisma = new PrismaClient()\n\nexport default async (req, res) => {\n  const salt = bcrypt.genSaltSync()\n  const { setName, password } = req.body\n  let set\n  try {\n    set = await prisma.set.create({\n      data: {\n        setName,\n        password: bcrypt.hashSync(password, salt),\n      },\n    })\n  } catch (error) {\n    console.log(error)\n    res.json({ error: error})\n    return\n  }\n  const token = jwt.sign(\n    { setName: set.setName, id: set.id, time: new Date() },\n    process.env.JWT_SECRET,\n    {\n      expiresIn: \"6h\",\n    }\n  )\n\n  res.setHeader(\n    \"Set-Cookie\",\n    cookie.serialize(\"token, token\", {\n      httpOnly: true,\n      maxAge: 6 * 60 * 60,\n      path: \"/\",\n      sameSite: \"lax\",\n      secure: process.env.NODE_ENV === \"production\",\n    })\n  )\n  res.json(set)\n  return\n}\n"]},"metadata":{},"sourceType":"module"}