{"ast":null,"code":"import bcrypt from 'bcrypt';\nimport jwt from 'jsonwebtoken';\nimport cookie from 'cookie';\nimport { PrismaClient } from '@prisma/client';\nconst prisma = new PrismaClient();\nexport default (async (req, res) => {\n  const salt = bcrypt.genSaltSync();\n  const {\n    gigName,\n    password\n  } = req.body;\n  let set;\n\n  try {\n    set = await console.log(prisma.Set.create({\n      data: {\n        setName: gigName,\n        password: bcrypt.hashSync(password, salt)\n      }\n    }));\n  } catch (error) {\n    res.json({\n      error: \"set name already exists\"\n    });\n    return;\n  }\n\n  const token = jwt.sign({\n    setName: set.setName,\n    id: set.id,\n    time: new Date()\n  }, process.env.JWT_SECRET, {\n    expiresIn: \"6h\"\n  });\n  res.setHeader(\"Set-Cookie\", cookie.serialize(\"token\", token, {\n    httpOnly: true,\n    maxAge: 6 * 60 * 60,\n    path: \"/\",\n    sameSite: \"lax\",\n    secure: false\n  }));\n  res.json(set);\n  return;\n});","map":{"version":3,"sources":["/Users/elie/code/ehymowitz/set-sharer/pages/api/create.ts"],"names":["bcrypt","jwt","cookie","PrismaClient","prisma","req","res","salt","genSaltSync","gigName","password","body","set","console","log","Set","create","data","setName","hashSync","error","json","token","sign","id","time","Date","process","env","JWT_SECRET","expiresIn","setHeader","serialize","httpOnly","maxAge","path","sameSite","secure"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,OAAOC,GAAP,MAAgB,cAAhB;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,YAAT,QAA6B,gBAA7B;AACA,MAAMC,MAAM,GAAG,IAAID,YAAJ,EAAf;AAEA,gBAAe,OAAOE,GAAP,EAAYC,GAAZ,KAAoB;AACjC,QAAMC,IAAI,GAAGP,MAAM,CAACQ,WAAP,EAAb;AACA,QAAM;AAAEC,IAAAA,OAAF;AAAWC,IAAAA;AAAX,MAAwBL,GAAG,CAACM,IAAlC;AACA,MAAIC,GAAJ;;AACA,MAAI;AACFA,IAAAA,GAAG,GAAG,MAAMC,OAAO,CAACC,GAAR,CAAYV,MAAM,CAACW,GAAP,CAAWC,MAAX,CAAkB;AACxCC,MAAAA,IAAI,EAAE;AACJC,QAAAA,OAAO,EAAET,OADL;AAEJC,QAAAA,QAAQ,EAAEV,MAAM,CAACmB,QAAP,CAAgBT,QAAhB,EAA0BH,IAA1B;AAFN;AADkC,KAAlB,CAAZ,CAAZ;AAMD,GAPD,CAOE,OAAOa,KAAP,EAAc;AACdd,IAAAA,GAAG,CAACe,IAAJ,CAAS;AAAED,MAAAA,KAAK,EAAE;AAAT,KAAT;AACA;AACD;;AACD,QAAME,KAAK,GAAGrB,GAAG,CAACsB,IAAJ,CACZ;AAAEL,IAAAA,OAAO,EAAEN,GAAG,CAACM,OAAf;AAAwBM,IAAAA,EAAE,EAAEZ,GAAG,CAACY,EAAhC;AAAoCC,IAAAA,IAAI,EAAE,IAAIC,IAAJ;AAA1C,GADY,EAEZC,OAAO,CAACC,GAAR,CAAYC,UAFA,EAGZ;AACEC,IAAAA,SAAS,EAAE;AADb,GAHY,CAAd;AAQAxB,EAAAA,GAAG,CAACyB,SAAJ,CACE,YADF,EAEE7B,MAAM,CAAC8B,SAAP,CAAiB,OAAjB,EAA0BV,KAA1B,EAAiC;AAC/BW,IAAAA,QAAQ,EAAE,IADqB;AAE/BC,IAAAA,MAAM,EAAE,IAAI,EAAJ,GAAS,EAFc;AAG/BC,IAAAA,IAAI,EAAE,GAHyB;AAI/BC,IAAAA,QAAQ,EAAE,KAJqB;AAK/BC,IAAAA,MAAM;AALyB,GAAjC,CAFF;AAUA/B,EAAAA,GAAG,CAACe,IAAJ,CAAST,GAAT;AACA;AACD,CAnCD","sourcesContent":["import bcrypt from 'bcrypt'\nimport jwt from 'jsonwebtoken'\nimport cookie from 'cookie'\nimport { PrismaClient } from '@prisma/client'\nconst prisma = new PrismaClient()\n\nexport default async (req, res) => {\n  const salt = bcrypt.genSaltSync()\n  const { gigName, password } = req.body\n  let set\n  try {\n    set = await console.log(prisma.Set.create({\n      data: {\n        setName: gigName,\n        password: bcrypt.hashSync(password, salt),\n      },\n    }))\n  } catch (error) {\n    res.json({ error: \"set name already exists\"})\n    return\n  }\n  const token = jwt.sign(\n    { setName: set.setName, id: set.id, time: new Date() },\n    process.env.JWT_SECRET,\n    {\n      expiresIn: \"6h\",\n    }\n  )\n\n  res.setHeader(\n    \"Set-Cookie\",\n    cookie.serialize(\"token\", token, {\n      httpOnly: true,\n      maxAge: 6 * 60 * 60,\n      path: \"/\",\n      sameSite: \"lax\",\n      secure: process.env.NODE_ENV === \"production\",\n    })\n  )\n  res.json(set)\n  return\n}\n"]},"metadata":{},"sourceType":"module"}